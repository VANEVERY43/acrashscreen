var sendMessage;$(document).ready(function(){function g(){if(l&&m&&n){0==e&&$(".chat-lines").html("");for(var a=0;a<p.length;a++)t(p[a])}}function t(a){var b=$(".chat-lines");0==e&&b.html("");if(a&&!(a.messageid<=e)){var c=0==b.prop("scrollHeight")-(b.scrollTop()+b.outerHeight()),g=e;e=a.messageid;for(var k=0;k<a.chat_log.length;k++){var f=a.chat_log[k];if(!(f.id<=g)){var p=(new Date(1E3*f.time)).toLocaleTimeString(),h=f.msg,r=f.name,t=f.color,q="";f.admin&&"!"==h.charAt(0)?(h=h.substr(1),q='<div class="chat-line noticable">'):q=
'<div class="chat-line">';if(l||m||n)for(var f=h.split(" "),h="",u=0;u<f.length;u++){var d=f[u];v[d]?d='<img class="emote" data-name="'+d+'" src="'+y.replace("{image_id}",v[d])+'">':w[d]?d='<img class="emote" data-name="'+d+'" src="'+z.replace("{image_id}",w[d])+'">':x[d]?d='<img class="emote" data-name="'+d+'" src="'+x[d]+'">':0!=u&&(d=" "+d);h+=d}q+='<span class="time">'+p+' </span><span class="name" style="color:#'+t+';">'+r+'</span><span>:&nbsp;</span><span class="text">'+h+"</span></div>";b.append(q)}}c&&
(a=b.children().length,250<a&&$(".chat-line:lt("+(a-250)+")").remove(),b.animate({scrollTop:b.prop("scrollHeight")},"fast"))}}function r(){$.ajax({url:"get_messages.php",type:"POST",data:{cur_msg_id:e},dataType:"json",success:function(a){l&&m&&n?t(a):p.push(a)}})}var e=0,p=[],l=!1,m=!1,n=!1,y="",z="",v=[],w=[],x=[];$.ajax({url:"https://twitchemotes.com/api_cache/v2/global.json",dataType:"json",cache:!0,success:function(a){y=a.template.small.replace("//","https://");for(var b in a.emotes)v[b]=a.emotes[b].image_id;
l=!0;g()},error:function(){l=!0;g()}});$.ajax({url:"https://twitchemotes.com/api_cache/v2/subscriber.json",dataType:"json",cache:!0,success:function(a){z=a.template.small.replace("//","https://");for(var b in a.channels){var c=a.channels[b],e;for(e in c.emotes){var k=c.emotes[e];w[k.code]=k.image_id}}m=!0;g()},error:function(){m=!0;g()}});$.ajax({url:"https://api.betterttv.net/emotes",dataType:"json",cache:!0,success:function(a){for(var b in a.emotes){var c=a.emotes[b];x[c.regex]=c.url}n=!0;g()},
error:function(){n=!0;g()}});sendMessage=function(a){""!=a&&$.post("send_message.php",{message:a},function(){r()})};setInterval(r,1500);r();var A=0;$(".chat-lines").on("scroll",function(){var a=$(this).scrollTop(),b=A;A=a;var c=$(".chat-lines");if(a>b)1>=c.prop("scrollHeight")-(c.scrollTop()+c.outerHeight())&&$("#more-messages-notify").remove();else if(!$("#more-messages-notify").length&&0<c.prop("scrollHeight")-(c.scrollTop()+c.outerHeight()))$('<div id="more-messages-notify">More messages below</div>').appendTo("body").show().on("click",
function(){$(".chat-lines").animate({scrollTop:$(".chat-lines").prop("scrollHeight")},"fast")})});$(document).on("mouseenter","*[data-name]",function(a){var b=$(a.target);a=$('<div id="tooltip" />').appendTo("body").html(b.data("name")).show();var c=b.offset(),e=c.top-a.outerHeight()-4,b=c.left-a.outerWidth()+.5*b.outerWidth()+8;a.css({top:e,left:b})});$(document).on("mouseleave","*[data-name]",function(a){$("#tooltip").remove()})});